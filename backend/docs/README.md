# Balance 系统文档中心

## 项目概述

Balance 是一个虾皮店铺订单发货平台，支持店主、运营、平台三种角色，提供订单同步、发货管理、财务结算等功能。

## 文档目录

| 文档 | 说明 |
|------|------|
| [README.md](README.md) | 项目概述（本文档） |
| [API_REFERENCE.md](API_REFERENCE.md) | API 接口文档 |
| [DATABASE_DESIGN.md](DATABASE_DESIGN.md) | 数据库设计文档 |
| [BUSINESS_FLOWCHART.md](BUSINESS_FLOWCHART.md) | 业务流程图 |
| [PROJECT_FLOW_ANALYSIS.md](PROJECT_FLOW_ANALYSIS.md) | 项目流程分析 |
| [SHARDING_DESIGN.md](SHARDING_DESIGN.md) | 分表设计文档 |
| [MONITORING.md](MONITORING.md) | 监控告警文档 |

## 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端                                │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐        │
│  │店主前端 │  │运营前端 │  │平台前端 │  │移动端   │        │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘        │
└───────┼────────────┼────────────┼────────────┼──────────────┘
        └────────────┴────────────┴────────────┘
                           │
                    ┌──────▼──────┐
                    │   Nginx     │
                    └──────┬──────┘
                           │
┌──────────────────────────┼──────────────────────────┐
│                    应用服务层                        │
│  ┌──────────────┐  ┌──────────────┐                 │
│  │ Admin 服务   │  │  App 服务    │                 │
│  │ (Web后台)    │  │ (移动端)     │                 │
│  └──────┬───────┘  └──────┬───────┘                 │
└─────────┼─────────────────┼─────────────────────────┘
          └─────────┬───────┘
                    │
┌───────────────────┼───────────────────┐
│              数据层                    │
│  ┌────────┐  ┌────────┐  ┌────────┐  │
│  │ MySQL  │  │ Redis  │  │Shopee  │  │
│  │(分表)  │  │(缓存)  │  │ API    │  │
│  └────────┘  └────────┘  └────────┘  │
└───────────────────────────────────────┘
```

## 核心功能

### 用户角色

| 角色 | user_type | 功能 |
|------|-----------|------|
| 店主 | 1 | 店铺管理、订单查看、发货、财务 |
| 运营 | 5 | 代发货、结算查看、提现 |
| 平台 | 9 | 用户管理、审核、佣金管理 |

### 功能模块

| 模块 | 说明 |
|------|------|
| 店铺管理 | Shopee OAuth授权、店铺信息同步 |
| 订单同步 | 增量/全量订单同步、状态更新 |
| 发货管理 | 单发/批量发货、物流跟踪 |
| 财务结算 | 结算明细同步、三方分成 |
| 账户管理 | 预付款、保证金、佣金账户 |
| 提现充值 | 申请、审核、打款 |

## 技术栈

| 层级 | 技术 |
|------|------|
| 语言 | Go 1.21+ |
| Web框架 | Gin |
| ORM | GORM |
| 数据库 | MySQL 8.0+ (120个分表) |
| 缓存 | Redis 7.0+ |
| 认证 | JWT |
| 监控 | Prometheus + Grafana |
| 部署 | Docker / Kubernetes |

## 分表设计

系统采用水平分表策略，共 **120个分表**：

| 分表类型 | 数量 | 规则 |
|----------|------|------|
| 订单相关 | 80 | shop_id % 10 |
| 财务相关 | 20 | shop_id % 10 |
| 账户流水 | 10 | admin_id % 10 |
| 日志归档 | 10 | shop_id % 10 |

详见 [SHARDING_DESIGN.md](SHARDING_DESIGN.md)

## 分布式支持

| 组件 | 机制 |
|------|------|
| ID生成 | Redis Lua 原子操作 |
| 任务调度 | Redis 分布式锁 |
| 会话管理 | JWT 无状态 |
| 缓存 | Redis 集中式 |

## 快速开始

```bash
# 1. 克隆项目
git clone https://github.com/your-org/balance.git

# 2. 初始化数据库
mysql -u root -p < database.sql

# 3. 配置文件
cp config/config.example.yaml config/config.yaml
# 编辑配置文件...

# 4. 启动服务
cd backend/admin
go run main.go -config config/config.yaml
```

## 相关链接

- [Admin 文档](../admin/docs/README.md)
- [App 文档](../app/docs/README.md)
- [部署指南](../admin/docs/deployment.md)
- [备份策略](../admin/docs/backup_strategy.md)
